1) Делаем копии адресных схем osm (текущая становится osm_old), addr (addr_old), routing (routing_old)
2) Перенос актуальных данных OpenStreetMap:
- Скачиваем файл с OpenStreetMap
- Парсим утилитой osm2pgsql (заполняется указываемая БД)
3) Создаем структуру для ручной работы из скрипта hand_preapre.sql
4) Заполняем данными таблицу hand, если что-то делали вручную
5) Выполняем preapare_0_init -> _main
6) Выполняем function.sql вспомогательные функции
7) Выполняем prepare_1.sql для заполнение osm новыми данными с учетом hand
8) Выполняем prepare_2.sql для коррекции схемы osm с учетом hand
9) Сопоставляем старые и новые адресные данные (скрипты папки comparing):
- Создаем процедуры по сопоставлению адресных данных новой и предыдущей версии - compare_old_new_functions.sql
- Выполняем compare_old_new_init -> main
- На предыдущем шаге выводятся дубликаты и несопоставленные объекты, правим вручную
10) Выполняем prepare_4.sql для заполнения схемы addr
11) Дополняем схему addr обновлением таблиц search_roads, search_town_rn_rg и др. - выполняем скрипт search_roads.sql (если нет функций, создаем из папки utils)
12) Сопоставляем старую и новую таблицу search_roads вручную (что не сопоставилось после шага 11)
13) Через интерфейс админки заполняем зоны ответственности для search_roads.
14) Через интерфейс админки выполнить пересчет адресов ПСЧ по координатам для обновления привязки департаментов к новым адресным данным
15) Создаем граф дорог из вложенной папки routing:
- удаляем таблицы из routing схемы
- выполняем скрипты t01_* по созданию процедур для роутинга
- выполняем select t01_route_tables_maker()
16) Выполняем prepare_pch_table.sql для установления ближайших пч и районов по графу дорог